"use strict";(self["webpackChunkjust_sell"]=self["webpackChunkjust_sell"]||[]).push([[983],{2729:function(e,t,l){l.d(t,{Z:function(){return h}});var a=l(3396),n=l(7139),s=l(9167);const i=["checked","name","disabled"],r={key:0,for:"#checkbox-field",class:"checkbox-field__label"},o={id:"checkbox-field",class:"checkbox-field__box"},d={key:0,src:s,alt:"Checked"},c={key:0,class:"form-field__error"},u=(0,a.aZ)({emits:["change","update:modelValue"],data(){return{checked:this.$props.modelValue}},computed:{hasError(){return Boolean(this.$props.error)}},watch:{modelValue:{handler(e){this.checked="string"===typeof e?JSON.parse(e):e},immediate:!0}},methods:{check(){this.checked=!this.checked,this.$emit("change",this.checked),this.$emit("update:modelValue",this.checked)}}});var m=(0,a.aZ)({...u,__name:"CheckboxField",props:{name:null,label:null,defaultChecked:{type:Boolean},direction:{default:"right"},variant:{default:"primary"},size:{default:"md"},modelValue:{type:Boolean},disabled:null,error:null,justify:{default:"space-between"}},setup(e){return(t,l)=>((0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("input",{type:"checkbox",class:"checkbox-field__input",checked:e.modelValue||t.checked,name:e.name,disabled:e.disabled},null,8,i),(0,a._)("div",{class:(0,n.C_)(["checkbox-field",{"checkbox-field--checked":t.checked,"checkbox-field--disabled":e.disabled,[`checkbox-field--${e.direction}`]:!0,[`checkbox-field--${e.variant}`]:!0,[`checkbox-field--${e.size}`]:!0}]),style:(0,n.j5)({justifyContent:"space-between"===e.justify?"space-between":"flex-start"}),onClick:l[0]||(l[0]=(...e)=>t.check&&t.check(...e))},[Boolean(e.label)?((0,a.wg)(),(0,a.iD)("label",r,(0,n.zw)(e.label),1)):(0,a.kq)("",!0),(0,a._)("div",o,[t.checked?((0,a.wg)(),(0,a.iD)("img",d)):(0,a.kq)("",!0)])],6),t.hasError?((0,a.wg)(),(0,a.iD)("div",c,(0,n.zw)(e.error),1)):(0,a.kq)("",!0)],64))}});const p=m;var h=p},6426:function(e,t,l){l.d(t,{Z:function(){return b}});var a=l(3396),n=l(7139);function s(e,t,l,s,i,r){const o=(0,a.up)("v-button"),d=(0,a.up)("v-protected"),c=(0,a.up)("app-loading");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("input",{type:"file",class:"qr-scanner-file",ref:"fileInput",onChange:t[0]||(t[0]=(...t)=>e.onFileGet&&e.onFileGet(...t))},null,544),(0,a.Wm)(d,{rule:e.Rules.ADD_TERMINAL},{content:(0,a.w5)((({canRender:t})=>[(0,a.Wm)(o,{onClick:e.openScan,disabled:!t},{text:(0,a.w5)((()=>[(0,a.Uk)("Додати через фото")])),_:2},1032,["onClick","disabled"])])),_:1},8,["rule"]),(0,a._)("div",{class:(0,n.C_)(["qr-scanner-file__loader",{opened:e.loading}])},[(0,a.Wm)(c,{loading:e.loading},null,8,["loading"])],2)],64)}l(7658);var i=l(4610),r=l(2456),o=l(7863),d=l(5577),c=l(7547),u=l(473);const m=async e=>{const t=new FormData;t.append("file",e);const{data:l}=await c.d.postForm(u.M.SCAN_QR,{file:e});return l};var p=l(4677),h=(0,a.aZ)({emits:["stop:scan"],components:{VButton:i.Z,AppLoading:o.Z,VProtected:r.Z},setup(){const e=(0,p.pm)();return{toast:e,Rules:d.i}},data(){return{loading:!1}},methods:{openScan(){const e=this.$refs.fileInput;e.click()},async onFileGet(e){this.loading=!0;const t=e.target.files[0],l=await m(t);if(0===l.code){const e=!l.id.startsWith("https"),t=new URL(e?`https://localhost/Terminal/Activate?id=${l.id}`:l.id),a=t.pathname+t.search;return this.loading=!1,this.$emit("stop:scan"),void this.$router.push(a)}this.toast.error("Не вдалося розпізнати код. Спробуйте ще раз"),this.loading=!1}}}),f=l(89);const _=(0,f.Z)(h,[["render",s]]);var b=_},8983:function(e,t,l){l.r(t),l.d(t,{default:function(){return ke}});var a=l(3396);const n={key:0,class:"terminals-extra-actions"};function s(e,t,l,s,i,r){const o=(0,a.up)("app-loading"),d=(0,a.up)("qr-scanner-link"),c=(0,a.up)("qr-scanner-file"),u=(0,a.up)("add-by-id"),m=(0,a.up)("terminal-filters"),p=(0,a.up)("terminal-table"),h=(0,a.up)("app-layout");return(0,a.wg)(),(0,a.j4)(h,null,{appLoading:(0,a.w5)((()=>[(0,a.Wm)(o,{loading:e.loading},null,8,["loading"])])),appExtra:(0,a.w5)((()=>[e.hasTerminals?((0,a.wg)(),(0,a.iD)("div",n,[(0,a.Wm)(d),(0,a.Wm)(c),(0,a.Wm)(u)])):(0,a.kq)("",!0)])),appTitle:(0,a.w5)((()=>[(0,a.Uk)("Перегляд терміналів")])),appContent:(0,a.w5)((()=>[(0,a.Wm)(m,{"onUpdate:filters":e.filter},null,8,["onUpdate:filters"]),(0,a.Wm)(p,{data:e.terminals,empty:!e.hasTerminals,total:e.total,"has-pagination":!0},null,8,["data","empty","total"])])),_:1})}var i=l(5627),r=l(7863),o=l(2240),d=l(3e3),c=l(6661);function u(e,t,l,n,s,i){const r=(0,a.up)("terminal-actions"),o=(0,a.up)("v-popover");return(0,a.wg)(),(0,a.j4)(o,null,{actions:(0,a.w5)((({close:t})=>[(0,a.Wm)(r,{onClose:t,terminal:e.terminal},null,8,["onClose","terminal"])])),_:1})}var m=l(7004),p=l(7139);const h=["onClick"],f={key:0},_={class:"popover-action__loader"};function b(e,t,l,n,s,i){const r=(0,a.up)("edit-action"),o=(0,a.up)("v-spinner");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(r,{terminal:e.terminal},null,8,["terminal"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.commands,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.value,class:"popover-action",onClick:l=>e.sendCommand(t.value)},[e.loading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("span",f,(0,p.zw)(t.label),1)),(0,a._)("div",_,[e.loading?((0,a.wg)(),(0,a.j4)(o,{key:0,color:"accent"})):(0,a.kq)("",!0)])],8,h)))),128))],64)}var k=l(3587),g=l(6265);function v(e,t,l,n,s,i){const r=(0,a.up)("v-protected");return(0,a.wg)(),(0,a.j4)(r,{rule:e.Rules.EDIT_TERMINAL},{content:(0,a.w5)((({canRender:l})=>[(0,a._)("div",{class:(0,p.C_)(["popover-action",{"popover-action--disabled":!l}]),onClick:t[0]||(t[0]=(...t)=>e.openEdit&&e.openEdit(...t))}," Редагувати ",2)])),_:1},8,["rule"])}l(7658);var w=l(5577),y=l(2456),V=l(5498),Z=(0,a.aZ)({components:{VProtected:y.Z},props:["terminal"],setup(){return{Rules:w.i}},methods:{openEdit(){window.localStorage.setItem(V.Om,JSON.stringify(this.terminal)),this.$router.push({name:"editTerminal"})}}}),D=l(89);const $=(0,D.Z)(Z,[["render",v]]);var x=$,W=l(4677),C=(0,a.aZ)({emits:["close"],props:["terminal"],components:{VSpinner:k.Z,EditAction:x},setup(){const e=(0,W.pm)();return{toast:e}},data(){return{loading:!1}},computed:{commands(){const e=this.$store.state.terminals.terminalsRef;if(!e)return[];const t=e.trm_cmd.map((e=>({value:e.id.toString(),label:e.name||""})));return t}},methods:{async sendCommand(e){try{this.loading=!0,await(0,g.WW)({terminal_id:this.terminal.ID,cmd_id:e}),this.loading=!1,this.$emit("close"),this.toast.success("Команду успішно відправлено!")}catch(t){console.log(t)}}}});const T=(0,D.Z)(C,[["render",b]]);var F=T,R=(0,a.aZ)({props:["terminal"],components:{VPopover:m.Z,TerminalActions:F}});const E=(0,D.Z)(R,[["render",u]]);var A=E;const S=(0,a.aZ)({components:{VTable:c.Z}});var I=(0,a.aZ)({...S,__name:"TerminalTable",props:{data:null,empty:{type:Boolean},total:null},setup(e){const t=(0,d.Cl)(),l=[t.accessor("ID",{cell:e=>{const t=e.getValue(),l=e.row.getIsExpanded(),a=e.row.getToggleExpandedHandler();return(0,o.A)(t,l,a)},header:e=>e.column.id,sortDescFirst:!0}),t.accessor("serial_number",{cell:e=>e.getValue(),header:"SN пристрою",sortDescFirst:!0}),t.accessor("can_offline",{header:"Чи працює оффлайн",cell:e=>JSON.parse(e.getValue()||"false")?"Так":"Ні",sortDescFirst:!0}),t.accessor("max_offline_sum",{header:"Максимальна оффлайн сумма",cell:e=>e.getValue(),sortDescFirst:!0}),t.accessor("last_online",{cell:e=>e.getValue(),header:"Востаннє онлайн",sortDescFirst:!0}),t.accessor("last_start",{cell:e=>e.getValue(),header:"Останній старт",sortDescFirst:!0}),t.accessor("add_time",{cell:e=>e.getValue(),header:"Дата активації",sortDescFirst:!0}),t.display({cell:e=>(0,a.h)(A,{terminal:e.row.original}),header:"Дії"})];return(t,n)=>((0,a.wg)(),(0,a.j4)(c.Z,{data:e.data,columns:l,empty:e.empty,total:e.total},{"context-menu":(0,a.w5)((({values:e})=>[(0,a.Wm)(F,{terminal:e},null,8,["terminal"])])),_:1},8,["data","empty","total"]))}});const q=I;var j=q;function U(e,t,l,n,s,i){const r=(0,a.up)("v-button"),o=(0,a.up)("router-link"),d=(0,a.up)("v-protected");return(0,a.wg)(),(0,a.j4)(d,{rule:e.Rules.ADD_TERMINAL},{content:(0,a.w5)((({canRender:e})=>[(0,a.Wm)(o,{to:{name:"activateTerminal"},class:"terminal-create-btn"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{hasMaxWidth:!1,disabled:!e},{text:(0,a.w5)((()=>[(0,a.Uk)("Додати термінал по номеру")])),_:2},1032,["disabled"])])),_:2},1024)])),_:1},8,["rule"])}var L=l(4610),N=(0,a.aZ)({components:{VProtected:y.Z,VButton:L.Z},setup(){return{Rules:w.i}}});const B=(0,D.Z)(N,[["render",U]]);var z=B,M=l(6426);function O(e,t,l,n,s,i){const r=(0,a.up)("v-button"),o=(0,a.up)("router-link"),d=(0,a.up)("v-protected");return(0,a.wg)(),(0,a.j4)(d,{rule:e.Rules.ADD_TERMINAL},{content:(0,a.w5)((({canRender:e})=>[(0,a.Wm)(o,{to:"/qr"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{disabled:!e},{text:(0,a.w5)((()=>[(0,a.Uk)(" Додати термінал через QR-code ")])),_:2},1032,["disabled"])])),_:2},1024)])),_:1},8,["rule"])}var G=(0,a.aZ)({components:{VButton:L.Z,VProtected:y.Z},setup(){return{Rules:w.i}}});const H=(0,D.Z)(G,[["render",O]]);var P=H;const Q={class:"filters terminal-filters"},Y={class:"filters-row"},J={class:"filters-item"},K={class:"filters-item"},X={class:"filters-item"},ee={class:"filters-checkbox"},te={class:"filters-actions"};function le(e,t,l,n,s,i){const r=(0,a.up)("input-field"),o=(0,a.up)("form-field"),d=(0,a.up)("companies-filter"),c=(0,a.up)("checkbox-field"),u=(0,a.up)("v-button");return(0,a.wg)(),(0,a.iD)("div",Q,[(0,a._)("div",Y,[(0,a._)("div",J,[(0,a.Wm)(o,{shadow:!0,small:"",label:"Темінал"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"terminal_name",modelValue:e.filters.terminal_id,"onUpdate:modelValue":t[0]||(t[0]=t=>e.filters.terminal_id=t),placeholder:"Темінал ID",disabled:!1,size:"sm"},null,8,["modelValue"])])),_:1})]),(0,a._)("div",K,[(0,a.Wm)(o,{shadow:!0,small:"",label:"ID ПТКС"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"ptks_num",modelValue:e.filters.ptks_num,"onUpdate:modelValue":t[1]||(t[1]=t=>e.filters.ptks_num=t),placeholder:"ID ПТКС",disabled:!1,size:"sm"},null,8,["modelValue"])])),_:1})]),(0,a.Wm)(d,{modelValue:e.filters.company_id,"onUpdate:modelValue":t[2]||(t[2]=t=>e.filters.company_id=t)},null,8,["modelValue"]),(0,a._)("div",X,[(0,a.Wm)(o,{shadow:!0,small:"",label:"SN пристрою"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"serial_number",modelValue:e.filters.serial_number,"onUpdate:modelValue":t[3]||(t[3]=t=>e.filters.serial_number=t),placeholder:"SN пристрою",disabled:!1,size:"sm"},null,8,["modelValue"])])),_:1})]),(0,a._)("div",ee,[(0,a.Wm)(c,{name:"test_mode",modelValue:e.filters.test_mode,"onUpdate:modelValue":t[4]||(t[4]=t=>e.filters.test_mode=t),label:"У тестовому режимі",direction:"left",justify:"none"},null,8,["modelValue"])]),(0,a._)("div",te,[(0,a.Wm)(u,{"has-max-width":!1,type:"button",onClick:e.applyFilter},{text:(0,a.w5)((()=>[(0,a.Uk)("Фільтрувати")])),_:1},8,["onClick"])])])])}var ae=l(4560),ne=l(2619);const se={key:0,class:"filters-item filters-companies-select"};function ie(e,t,l,n,s,i){const r=(0,a.up)("select-field"),o=(0,a.up)("form-field");return e.companies.length?((0,a.wg)(),(0,a.iD)("div",se,[(0,a.Wm)(o,{label:"Компанії",small:"",shadow:""},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{options:e.companies,name:"companies","input-placeholder":"Оберіть компанію","search-placeholder":"Введіть компанію","has-search":!1,"model-value":e.modelValue,"onUpdate:modelValue":e.select,size:"sm",disabled:e.disabled},null,8,["options","model-value","onUpdate:modelValue","disabled"])])),_:1})])):(0,a.kq)("",!0)}l(541);var re=l(6112),oe=(0,a.aZ)({props:{modelValue:String,small:{type:Boolean,required:!1},disabled:{required:!1}},emits:["update:modelValue","blur"],components:{FormField:ae.Z,SelectField:re.Z},computed:{companies(){const e=this.$store.state.terminals.terminalsRef;if(!e)return[];const t=e.parent_child.map((e=>({value:e.id.toString(),label:e.name||""})));return t.unshift({value:"",label:"Не обрано"}),t}},methods:{select(e){this.$emit("update:modelValue",e),this.$emit("blur",e)}}});const de=(0,D.Z)(oe,[["render",ie]]);var ce=de,ue=l(2729),me=(0,a.aZ)({emits:["update:filters"],components:{FormField:ae.Z,InputField:ne.Z,VButton:L.Z,CompaniesFilter:ce,CheckboxField:ue.Z},data(){return{filters:{terminal_id:"",ptks_num:"",company_id:"",test_mode:"false",serial_number:""}}},mounted(){this.filters={...this.filters,...this.$route.query}},watch:{"$route.query":{handler(e){this.filters={...this.filters,...e}},deep:!0,immediate:!0}},methods:{applyFilter(){const e=Object.fromEntries(Object.entries(this.$data.filters).filter((([e,t])=>"boolean"===typeof t||Boolean(t))));this.$router.replace({path:this.$route.path,query:e}),this.$emit("update:filters",e)}}});const pe=(0,D.Z)(me,[["render",le]]);var he=pe,fe=l(5384),_e=(0,a.aZ)({components:{AppLayout:i.Z,TerminalTable:j,AppLoading:r.Z,QrScannerLink:P,AddById:z,QrScannerFile:M.Z,TerminalFilters:he},computed:{loading(){return this.$store.state.terminals.loading},terminals(){return this.$store.state.terminals.terminals},hasTerminals(){return this.$store.state.terminals.terminals&&this.$store.state.terminals.terminals.length>0},total(){return this.$store.state.terminals.total}},watch:{"$route.query":{handler(e){this.filter(e)},deep:!0,immediate:!0}},mounted(){this.$store.dispatch(fe.T.GET_TERMINALS_REF)},beforeUnmount(){this.$store.dispatch(fe.T.CLEAR_TERMINALS)},methods:{filter(e){this.$store.dispatch(fe.T.GET_TERMINALS,e)}}});const be=(0,D.Z)(_e,[["render",s]]);var ke=be},9167:function(e,t,l){e.exports=l.p+"img/check-icon.972bc3c4.svg"}}]);
//# sourceMappingURL=983.cb85faab.js.map